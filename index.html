<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#10b981">
    <title>مجدول - تطبيق جدولة ساعات الجرار الزراعي</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #f59e0b;
            --accent: #3b82f6;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        /* تخصيص شريط التمرير */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* تأثيرات انتقالية */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* تأثيرات الظل */
        .shadow-soft {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* تخصيص زر فلوتر */
        .floating-btn {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* تخصيص الكروت */
        .schedule-card {
            border-right: 4px solid var(--primary);
        }
        
        /* رسوميات الخلفية */
        .bg-pattern {
            background-color: #f8fafc;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2310b981' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
    
    <!-- إعداد Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981',
                        'primary-dark': '#059669',
                        secondary: '#f59e0b',
                        accent: '#3b82f6',
                    },
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 font-cairo min-h-screen">
    <!-- الهيدر -->
    <header class="bg-gradient-to-l from-primary to-primary-dark text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="bg-white p-2 rounded-full">
                        <i class="fas fa-tractor text-primary text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">مجدول</h1>
                        <p class="text-sm text-white/80">تطبيق جدولة ساعات الجرار الزراعي</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button id="theme-toggle" class="p-2 rounded-full bg-white/20 hover:bg-white/30 transition-all">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="install-btn" class="hidden px-3 py-1 bg-white text-primary font-semibold rounded-lg hover:bg-gray-100 transition-all">
                        تثبيت
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- المحتوى الرئيسي -->
    <main class="container mx-auto px-4 py-6 pb-24">
        <!-- إحصائيات سريعة -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 animate-fade-in">
            <!-- إجمالي الساعات -->
            <div class="bg-white rounded-2xl shadow-soft p-6 border-r-4 border-primary">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">إجمالي الساعات</p>
                        <h3 id="total-hours" class="text-3xl font-bold text-gray-800 mt-1">0</h3>
                    </div>
                    <div class="bg-primary/10 p-3 rounded-full">
                        <i class="fas fa-clock text-primary text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-3">مجموع ساعات العمل المنجزة</p>
            </div>
            
            <!-- عدد العملاء -->
            <div class="bg-white rounded-2xl shadow-soft p-6 border-r-4 border-accent">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">عدد العملاء</p>
                        <h3 id="total-customers" class="text-3xl font-bold text-gray-800 mt-1">0</h3>
                    </div>
                    <div class="bg-accent/10 p-3 rounded-full">
                        <i class="fas fa-users text-accent text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-3">إجمالي العملاء المضافة</p>
            </div>
            
            <!-- ساعات اليوم -->
            <div class="bg-white rounded-2xl shadow-soft p-6 border-r-4 border-secondary">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">ساعات اليوم</p>
                        <h3 id="today-hours" class="text-3xl font-bold text-gray-800 mt-1">0</h3>
                    </div>
                    <div class="bg-secondary/10 p-3 rounded-full">
                        <i class="fas fa-calendar-day text-secondary text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mt-3">ساعات العمل لليوم الحالي</p>
            </div>
        </div>
        
        <!-- التاريخ الحالي -->
        <div class="mb-6 p-4 bg-gradient-to-l from-primary/10 to-accent/10 rounded-xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <i class="fas fa-calendar-alt text-primary text-xl"></i>
                    <h2 id="current-date" class="text-lg font-semibold text-gray-800">الثلاثاء، 10 ديسمبر 2024</h2>
                </div>
                <button id="today-btn" class="px-4 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-all">
                    اليوم
                </button>
            </div>
        </div>
        
        <!-- نموذج إضافة جدول جديد -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8 animate-slide-up">
            <div class="bg-gradient-to-l from-primary to-primary-dark p-5">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <i class="fas fa-plus-circle text-white text-2xl"></i>
                    <h2 class="text-xl font-bold text-white">إضافة جدول عمل جديد</h2>
                </div>
            </div>
            
            <form id="schedule-form" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- اسم الزبون -->
                    <div>
                        <label for="customer-name" class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-user text-primary ml-1"></i>
                            اسم الزبون
                        </label>
                        <div class="relative">
                            <input type="text" id="customer-name" required
                                   class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                                   placeholder="أدخل اسم الزبون">
                            <i class="fas fa-user absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- رقم الهاتف -->
                    <div>
                        <label for="phone" class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-phone text-primary ml-1"></i>
                            رقم الهاتف
                        </label>
                        <div class="relative">
                            <input type="tel" id="phone" required
                                   class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                                   placeholder="أدخل رقم الهاتف">
                            <i class="fas fa-phone absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- التاريخ -->
                    <div>
                        <label for="date" class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-calendar text-primary ml-1"></i>
                            التاريخ
                        </label>
                        <div class="relative">
                            <input type="date" id="date" required
                                   class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                            <i class="fas fa-calendar absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- عدد الساعات -->
                    <div>
                        <label for="hours" class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-clock text-primary ml-1"></i>
                            عدد الساعات
                        </label>
                        <div class="relative">
                            <input type="number" id="hours" min="1" max="24" required
                                   class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                                   placeholder="عدد الساعات">
                            <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500">ساعة</span>
                        </div>
                    </div>
                    
                    <!-- ملاحظات -->
                    <div class="md:col-span-2">
                        <label for="notes" class="block text-gray-700 font-medium mb-2">
                            <i class="fas fa-sticky-note text-primary ml-1"></i>
                            ملاحظات (اختياري)
                        </label>
                        <div class="relative">
                            <input type="text" id="notes"
                                   class="w-full p-4 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                                   placeholder="أي ملاحظات إضافية">
                            <i class="fas fa-sticky-note absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                
                <!-- أزرار النموذج -->
                <div class="flex flex-col sm:flex-row gap-4 justify-end">
                    <button type="reset" class="px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all">
                        <i class="fas fa-redo ml-2"></i>
                        إعادة تعيين
                    </button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:bg-primary-dark transition-all flex items-center justify-center">
                        <i class="fas fa-save ml-2"></i>
                        حفظ الجدول
                    </button>
                </div>
            </form>
        </div>
        
        <!-- قائمة الجداول -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden animate-slide-up">
            <div class="bg-gradient-to-l from-accent to-blue-500 p-5">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <i class="fas fa-list text-white text-2xl"></i>
                        <h2 class="text-xl font-bold text-white">جدول العمل</h2>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full">
                        <span id="schedule-count" class="text-white font-semibold">0 جدول</span>
                    </div>
                </div>
            </div>
            
            <!-- تصفية الجداول -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                    <div class="flex space-x-2 space-x-reverse">
                        <button id="filter-all" class="px-4 py-2 bg-primary text-white font-medium rounded-lg transition-all">الكل</button>
                        <button id="filter-today" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-all">اليوم</button>
                        <button id="filter-week" class="px-4 py-2 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition-all">هذا الأسبوع</button>
                    </div>
                    
                    <div class="relative w-full sm:w-auto">
                        <input type="text" id="search-input" placeholder="بحث عن عميل..."
                               class="w-full p-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all">
                        <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
            </div>
            
            <!-- قائمة الجداول -->
            <div class="p-4" id="schedules-list">
                <!-- سيتم تعبئة الجداول هنا ديناميكيًا -->
                <div class="text-center py-12">
                    <div class="mb-4">
                        <i class="fas fa-calendar-plus text-gray-300 text-6xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-500 mb-2">لا توجد جداول مضافة بعد</h3>
                    <p class="text-gray-400">ابدأ بإضافة أول جدول عمل باستخدام النموذج أعلاه</p>
                </div>
            </div>
        </div>
    </main>

    <!-- زر فلوتر للإضافة السريعة -->
    <button id="quick-add-btn" class="floating-btn fixed bottom-24 left-6 w-14 h-14 bg-primary text-white rounded-full flex items-center justify-center text-2xl shadow-lg hover:bg-primary-dark transition-all z-40">
        <i class="fas fa-plus"></i>
    </button>

    <!-- ناف بار سفلي -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 py-3 px-2 shadow-lg z-40">
        <div class="flex justify-around items-center">
            <!-- الرئيسية -->
            <button id="nav-home" class="nav-btn flex flex-col items-center text-primary">
                <i class="fas fa-home text-xl mb-1"></i>
                <span class="text-xs font-medium">الرئيسية</span>
            </button>
            
            <!-- التقويم -->
            <button id="nav-calendar" class="nav-btn flex flex-col items-center text-gray-500">
                <i class="fas fa-calendar-alt text-xl mb-1"></i>
                <span class="text-xs font-medium">التقويم</span>
            </button>
            
            <!-- المشاركة -->
            <button id="nav-share" class="nav-btn flex flex-col items-center text-gray-500">
                <i class="fas fa-share-alt text-xl mb-1"></i>
                <span class="text-xs font-medium">مشاركة</span>
            </button>
            
            <!-- التقارير -->
            <button id="nav-reports" class="nav-btn flex flex-col items-center text-gray-500">
                <i class="fas fa-chart-bar text-xl mb-1"></i>
                <span class="text-xs font-medium">تقارير</span>
            </button>
        </div>
    </nav>

    <!-- مودال تفاصيل الجدول -->
    <div id="schedule-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl w-full max-w-md overflow-hidden animate-fade-in">
            <div class="bg-primary p-5 flex justify-between items-center">
                <h3 class="text-xl font-bold text-white">تفاصيل الجدول</h3>
                <button id="close-modal" class="text-white text-2xl hover:text-gray-200">&times;</button>
            </div>
            <div class="p-6" id="modal-content">
                <!-- سيتم تعبئة المحتوى هنا ديناميكيًا -->
            </div>
        </div>
    </div>

    <!-- رسالة تأكيد -->
    <div id="toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300 opacity-0 -translate-y-10">
        <div class="flex items-center space-x-3 space-x-reverse">
            <i class="fas fa-check-circle"></i>
            <span id="toast-message">تمت العملية بنجاح</span>
        </div>
    </div>

    <script>
        // بيانات التطبيق
        let schedules = JSON.parse(localStorage.getItem('tractorSchedules')) || [];
        let currentFilter = 'all';
        
        // عناصر DOM
        const scheduleForm = document.getElementById('schedule-form');
        const schedulesList = document.getElementById('schedules-list');
        const totalHoursElement = document.getElementById('total-hours');
        const totalCustomersElement = document.getElementById('total-customers');
        const todayHoursElement = document.getElementById('today-hours');
        const scheduleCountElement = document.getElementById('schedule-count');
        const currentDateElement = document.getElementById('current-date');
        const quickAddBtn = document.getElementById('quick-add-btn');
        const toast = document.getElementById('toast');
        const scheduleModal = document.getElementById('schedule-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const todayBtn = document.getElementById('today-btn');
        
        // تهيئة التطبيق عند التحميل
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين التاريخ الحالي في حقل التاريخ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // تحديث التاريخ الحالي في الواجهة
            updateCurrentDate();
            
            // تحميل البيانات وعرضها
            renderSchedules();
            updateStats();
            
            // إعداد أزرار التنقل
            setupNavigation();
            
            // إعداد التصفية والبحث
            setupFilterAndSearch();
            
            // إعداد زر التثبيت PWA
            setupPWA();
            
            // إعداد تبديل السمة
            setupThemeToggle();
        });
        
        // تحديث التاريخ الحالي في الواجهة
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            currentDateElement.textContent = now.toLocaleDateString('ar-SA', options);
        }
        
        // تحديث الإحصائيات
        function updateStats() {
            const totalHours = schedules.reduce((sum, schedule) => sum + parseInt(schedule.hours), 0);
            const uniqueCustomers = [...new Set(schedules.map(schedule => schedule.customerName))].length;
            
            // حساب ساعات اليوم
            const today = new Date().toISOString().split('T')[0];
            const todaySchedules = schedules.filter(schedule => schedule.date === today);
            const todayHours = todaySchedules.reduce((sum, schedule) => sum + parseInt(schedule.hours), 0);
            
            totalHoursElement.textContent = totalHours;
            totalCustomersElement.textContent = uniqueCustomers;
            todayHoursElement.textContent = todayHours;
            scheduleCountElement.textContent = `${schedules.length} جدول`;
        }
        
        // عرض الجداول
        function renderSchedules(filteredSchedules = null) {
            const schedulesToShow = filteredSchedules || schedules;
            
            if (schedulesToShow.length === 0) {
                schedulesList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="mb-4">
                            <i class="fas fa-calendar-plus text-gray-300 text-6xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-500 mb-2">لا توجد جداول مضافة</h3>
                        <p class="text-gray-400">${currentFilter === 'all' ? 'ابدأ بإضافة أول جدول عمل' : 'لا توجد جداول تطابق معايير البحث'}</p>
                    </div>
                `;
                return;
            }
            
            // ترتيب الجداول حسب التاريخ (الأحدث أولاً)
            const sortedSchedules = [...schedulesToShow].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            schedulesList.innerHTML = sortedSchedules.map((schedule, index) => `
                <div class="schedule-card bg-white border border-gray-200 rounded-xl p-5 mb-4 hover:shadow-md transition-all cursor-pointer" data-id="${schedule.id}" onclick="showScheduleDetails(${schedule.id})">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <h3 class="text-lg font-bold text-gray-800">${schedule.customerName}</h3>
                                <span class="mr-3 px-2 py-1 bg-primary/10 text-primary text-xs font-semibold rounded">${formatDate(schedule.date)}</span>
                            </div>
                            
                            <div class="flex flex-wrap items-center gap-4 text-gray-600">
                                <div class="flex items-center">
                                    <i class="fas fa-phone text-primary ml-1"></i>
                                    <span>${schedule.phone}</span>
                                </div>
                                
                                <div class="flex items-center">
                                    <i class="fas fa-clock text-secondary ml-1"></i>
                                    <span>${schedule.hours} ساعة</span>
                                </div>
                                
                                ${schedule.notes ? `
                                <div class="flex items-center">
                                    <i class="fas fa-sticky-note text-accent ml-1"></i>
                                    <span>${schedule.notes}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button class="call-btn p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-all" onclick="event.stopPropagation(); callCustomer('${schedule.phone}')" title="اتصال">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="delete-btn p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all" onclick="event.stopPropagation(); deleteSchedule(${schedule.id})" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // تنسيق التاريخ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { day: 'numeric', month: 'short' };
            return date.toLocaleDateString('ar-SA', options);
        }
        
        // عرض تفاصيل الجدول في المودال
        function showScheduleDetails(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            const date = new Date(schedule.date);
            const formattedDate = date.toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            document.getElementById('modal-content').innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="text-sm text-gray-500">الزبون</h4>
                        <p class="text-lg font-semibold">${schedule.customerName}</p>
                    </div>
                    
                    <div>
                        <h4 class="text-sm text-gray-500">رقم الهاتف</h4>
                        <p class="text-lg font-semibold">${schedule.phone}</p>
                    </div>
                    
                    <div>
                        <h4 class="text-sm text-gray-500">التاريخ</h4>
                        <p class="text-lg font-semibold">${formattedDate}</p>
                    </div>
                    
                    <div>
                        <h4 class="text-sm text-gray-500">عدد الساعات</h4>
                        <p class="text-lg font-semibold">${schedule.hours} ساعة</p>
                    </div>
                    
                    ${schedule.notes ? `
                    <div>
                        <h4 class="text-sm text-gray-500">الملاحظات</h4>
                        <p class="text-lg">${schedule.notes}</p>
                    </div>
                    ` : ''}
                    
                    <div class="pt-4 flex space-x-3 space-x-reverse">
                        <button onclick="callCustomer('${schedule.phone}')" class="flex-1 py-3 bg-primary text-white font-semibold rounded-xl hover:bg-primary-dark transition-all flex items-center justify-center">
                            <i class="fas fa-phone ml-2"></i>
                            اتصال
                        </button>
                        <button onclick="deleteSchedule(${schedule.id}); scheduleModal.classList.add('hidden');" class="flex-1 py-3 bg-red-600 text-white font-semibold rounded-xl hover:bg-red-700 transition-all flex items-center justify-center">
                            <i class="fas fa-trash ml-2"></i>
                            حذف
                        </button>
                    </div>
                </div>
            `;
            
            scheduleModal.classList.remove('hidden');
        }
        
        // اتصال بالعميل
        function callCustomer(phone) {
            if (confirm(`هل تريد الاتصال بـ ${phone}؟`)) {
                window.open(`tel:${phone}`);
            }
        }
        
        // حذف الجدول
        function deleteSchedule(id) {
            if (confirm('هل أنت متأكد من حذف هذا الجدول؟')) {
                schedules = schedules.filter(schedule => schedule.id !== id);
                localStorage.setItem('tractorSchedules', JSON.stringify(schedules));
                renderSchedules();
                updateStats();
                showToast('تم حذف الجدول بنجاح');
            }
        }
        
        // إضافة جدول جديد
        scheduleForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customer-name').value;
            const phone = document.getElementById('phone').value;
            const date = document.getElementById('date').value;
            const hours = document.getElementById('hours').value;
            const notes = document.getElementById('notes').value;
            
            const newSchedule = {
                id: Date.now(),
                customerName,
                phone,
                date,
                hours,
                notes,
                createdAt: new Date().toISOString()
            };
            
            schedules.push(newSchedule);
            localStorage.setItem('tractorSchedules', JSON.stringify(schedules));
            
            // إعادة تعيين النموذج
            scheduleForm.reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            // تحديث العرض
            renderSchedules();
            updateStats();
            
            // إظهار رسالة النجاح
            showToast('تم إضافة الجدول بنجاح!');
            
            // التمرير إلى الأعلى
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        // إعداد أزرار التنقل
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    navButtons.forEach(b => {
                        b.classList.remove('text-primary');
                        b.classList.add('text-gray-500');
                    });
                    this.classList.remove('text-gray-500');
                    this.classList.add('text-primary');
                    
                    const btnId = this.id;
                    
                    if (btnId === 'nav-home') {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else if (btnId === 'nav-calendar') {
                        showToast('عرض التقويم - قيد التطوير');
                    } else if (btnId === 'nav-share') {
                        shareApp();
                    } else if (btnId === 'nav-reports') {
                        showToast('عرض التقارير - قيد التطوير');
                    }
                });
            });
            
            // زر الإضافة السريعة
            quickAddBtn.addEventListener('click', function() {
                document.getElementById('customer-name').focus();
                window.scrollTo({ top: document.getElementById('schedule-form').offsetTop - 100, behavior: 'smooth' });
            });
            
            // زر "اليوم"
            todayBtn.addEventListener('click', function() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('date').value = today;
                document.getElementById('filter-today').click();
            });
            
            // إغلاق المودال
            closeModalBtn.addEventListener('click', function() {
                scheduleModal.classList.add('hidden');
            });
            
            // إغلاق المودال بالنقر خارج المحتوى
            scheduleModal.addEventListener('click', function(e) {
                if (e.target === scheduleModal) {
                    scheduleModal.classList.add('hidden');
                }
            });
        }
        
        // إعداد التصفية والبحث
        function setupFilterAndSearch() {
            // أزرار التصفية
            document.getElementById('filter-all').addEventListener('click', function() {
                currentFilter = 'all';
                updateFilterButtons(this);
                renderSchedules();
            });
            
            document.getElementById('filter-today').addEventListener('click', function() {
                currentFilter = 'today';
                updateFilterButtons(this);
                
                const today = new Date().toISOString().split('T')[0];
                const todaySchedules = schedules.filter(schedule => schedule.date === today);
                renderSchedules(todaySchedules);
            });
            
            document.getElementById('filter-week').addEventListener('click', function() {
                currentFilter = 'week';
                updateFilterButtons(this);
                
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(today.getDate() - 7);
                
                const weekSchedules = schedules.filter(schedule => {
                    const scheduleDate = new Date(schedule.date);
                    return scheduleDate >= weekAgo && scheduleDate <= today;
                });
                
                renderSchedules(weekSchedules);
            });
            
            // حقل البحث
            document.getElementById('search-input').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.trim() === '') {
                    renderSchedules();
                    return;
                }
                
                const filteredSchedules = schedules.filter(schedule => 
                    schedule.customerName.toLowerCase().includes(searchTerm) || 
                    schedule.phone.includes(searchTerm) ||
                    (schedule.notes && schedule.notes.toLowerCase().includes(searchTerm))
                );
                
                renderSchedules(filteredSchedules);
            });
        }
        
        // تحديث أزرار التصفية
        function updateFilterButtons(activeButton) {
            const filterButtons = document.querySelectorAll('#filter-all, #filter-today, #filter-week');
            filterButtons.forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            });
            
            activeButton.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
            activeButton.classList.add('bg-primary', 'text-white');
        }
        
        // مشاركة التطبيق
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'مجدول - تطبيق جدولة ساعات الجرار الزراعي',
                    text: 'تطبيق مفيد لتنظيم ساعات عمل الجرار الزراعي مع العملاء',
                    url: window.location.href
                })
                .then(() => console.log('تمت المشاركة بنجاح'))
                .catch(error => console.log('حدث خطأ في المشاركة:', error));
            } else {
                showToast('شارك الرابط: ' + window.location.href);
            }
        }
        
        // إظهار رسالة تأكيد
        function showToast(message) {
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('opacity-0', '-translate-y-10');
            toast.classList.add('opacity-100', 'translate-y-0');
            
            setTimeout(() => {
                toast.classList.remove('opacity-100', 'translate-y-0');
                toast.classList.add('opacity-0', '-translate-y-10');
            }, 3000);
        }
        
        // إعداد PWA
        function setupPWA() {
            let deferredPrompt;
            const installButton = document.getElementById('install-btn');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.classList.remove('hidden');
                
                installButton.addEventListener('click', () => {
                    installButton.classList.add('hidden');
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('تم تثبيت التطبيق');
                        }
                        deferredPrompt = null;
                    });
                });
            });
            
            // تسجيل Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('ServiceWorker registered successfully');
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            }
        }
        
        // إعداد تبديل السمة
        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('i');
            
            // التحقق من السمة المحفوظة
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeToggle.addEventListener('click', function() {
                const isDark = document.documentElement.classList.toggle('dark');
                
                if (isDark) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                    localStorage.setItem('theme', 'dark');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                    localStorage.setItem('theme', 'light');
                }
            });
        }
    </script>
    
    <!-- إضافة دعم السمة الداكنة -->
    <style>
        .dark body {
            background-color: #1f2937;
            color: #f9fafb;
        }
        
        .dark .bg-white {
            background-color: #374151 !important;
            color: #f9fafb;
        }
        
        .dark .bg-gray-50 {
            background-color: #111827 !important;
        }
        
        .dark .text-gray-800 {
            color: #f9fafb !important;
        }
        
        .dark .text-gray-700 {
            color: #e5e7eb !important;
        }
        
        .dark .text-gray-600 {
            color: #d1d5db !important;
        }
        
        .dark .text-gray-500 {
            color: #9ca3af !important;
        }
        
        .dark .border-gray-200 {
            border-color: #4b5563 !important;
        }
        
        .dark .border-gray-300 {
            border-color: #6b7280 !important;
        }
        
        .dark .bg-gray-100 {
            background-color: #4b5563 !important;
            color: #f9fafb;
        }
        
        .dark .bg-gray-200 {
            background-color: #6b7280 !important;
            color: #f9fafb;
        }
        
        .dark input, .dark select {
            background-color: #374151 !important;
            border-color: #6b7280 !important;
            color: #f9fafb !important;
        }
        
        .dark .schedule-card {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
        }
        
        .dark nav {
            background-color: #374151 !important;
            border-color: #4b5563 !important;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
    </style>
</body>
  </html> 
